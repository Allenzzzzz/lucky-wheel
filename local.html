<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Wheel Prize Draw - Smart Lock Special</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            width: 100%;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .highlight {
            background: linear-gradient(to right, #ff8a00, #ff2070);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: bold;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            width: 100%;
            margin-bottom: 30px;
        }
        
        .wheel-section {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .wheel-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }
        
        .wheel {
            width: 100%;
            height: auto;
            max-width: 500px;
            transition: transform 0.1s linear;
            transform-origin: center;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }
        
        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 60px;
            z-index: 10;
            color: #ff4757;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        }
        
        .spin-btn {
            background: linear-gradient(to right, #ff8a00, #ff2070);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.4rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(255, 32, 112, 0.4);
            letter-spacing: 1px;
        }
        
        .spin-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(255, 32, 112, 0.5);
        }
        
        .spin-btn:disabled {
            background: linear-gradient(to right, #a1a1a1, #7a7a7a);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .result-title {
            font-size: 1.8rem;
            color: #2575fc;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .current-result {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            color: white;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .result-label {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .result-value {
            font-size: 2.5rem;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .prizes-list {
            margin-bottom: 30px;
        }
        
        .prizes-title {
            font-size: 1.4rem;
            color: #2575fc;
            margin-bottom: 15px;
        }
        
        .prize-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            font-size: 1.1rem;
        }
        
        .prize-item:nth-child(odd) {
            background-color: #f9f9f9;
        }
        
        .prize-name {
            font-weight: 600;
        }
        
        .history-title {
            font-size: 1.4rem;
            color: #2575fc;
            margin-bottom: 15px;
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .history-item {
            padding: 8px 12px;
            border-bottom: 1px dashed #ddd;
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .counter {
            margin-top: 15px;
            font-size: 1.1rem;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: inline-block;
        }
        
        footer {
            margin-top: 30px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            font-size: 0.9rem;
            padding: 20px;
            width: 100%;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        @keyframes confetti {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(1000px) rotate(720deg); opacity: 0; }
        }
        
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background-color: #f0f;
            top: -20px;
            opacity: 0;
        }

        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 2px solid #FFD700;
            position: relative;
            animation: slideDown 0.4s ease-out;
        }

        .close-modal {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 15px;
            right: 20px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #ff4757;
        }

        .modal-content h2 {
            color: #2575fc;
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-content p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.05rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group textarea:focus,
        .form-group input:focus {
            border-color: #4ECDC4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
            outline: none;
        }

        .submit-btn {
            background: linear-gradient(to right, #4ECDC4, #2575fc);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            display: block;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(37, 117, 252, 0.4);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(37, 117, 252, 0.5);
        }

        .form-note {
            font-size: 0.9rem;
            color: #888;
            text-align: center;
            margin-top: 20px;
            font-style: italic;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
                align-items: center;
            }
            
            .wheel-section, .result-section {
                width: 100%;
                max-width: 100%;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .spin-btn {
                padding: 15px 30px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gift"></i> Lucky Wheel Prize Draw</h1>
            <p class="subtitle">Spin the wheel to win exciting prizes! <span class="highlight">Everyone wins a prize</span> - no empty slots! Each participant gets one chance to win from our 5 amazing rewards.</p>
        </header>
        
        <div class="content">
            <div class="wheel-section">
                <div class="wheel-container">
                    <svg class="wheel-pointer" viewBox="0 0 100 100">
                        <polygon points="50,0 65,100 35,100" fill="currentColor"/>
                    </svg>
                    <svg class="wheel" viewBox="0 0 300 300" id="wheel">
                        <!-- Wheel segments will be generated by JavaScript -->
                    </svg>
                </div>
                <button class="spin-btn" id="spinBtn">
                    <i class="fas fa-redo-alt"></i> SPIN TO WIN
                </button>
                <div class="counter" id="spinCounter">Spins remaining: <span id="remainingSpins">1</span></div>
            </div>
            
            <div class="result-section">
                <h2 class="result-title"><i class="fas fa-trophy"></i> Your Prize</h2>
                
                <div class="current-result">
                    <div class="result-label">Congratulations! You won:</div>
                    <div class="result-value" id="currentResult">Spin the wheel to see your prize</div>
                </div>
                
                <div class="prizes-list">
                    <h3 class="prizes-title"><i class="fas fa-star"></i> All Prizes</h3>
                    <div id="prizesList">
                        <!-- Prizes list will be generated by JavaScript -->
                    </div>
                </div>
                
                <div class="history">
                    <h3 class="history-title"><i class="fas fa-history"></i> Recent Winners</h3>
                    <div class="history-list" id="historyList">
                        <!-- History will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 中奖信息收集弹窗 -->
        <div id="specialPrizeModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2><i class="fas fa-trophy"></i> Congratulations!</h2>
                <p>Congratulations on winning the free smart lock! As part of our service, we'd like to visit your home to assess potential installation challenges. Please provide your details below so we can contact you after the event.</p>
                <form id="addressForm">
                    <div class="form-group">
                        <label for="userName">Your Name:</label>
                        <input type="text" id="userName" placeholder="Please enter your full name..." required>
                    </div>
                    <div class="form-group">
                        <label for="userAddress">Your Address:</label>
                        <textarea id="userAddress" rows="3" placeholder="Please enter your full address..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="userPhone">Phone Number:</label>
                        <input type="tel" id="userPhone" placeholder="Please enter your phone number..." required>
                    </div>
                    <button type="submit" class="submit-btn">Submit Information</button>
                </form>
                <p class="form-note">We will contact you within 3 business days to schedule the visit.</p>
            </div>
        </div>
        
        <footer>
            <p>This prize draw is for demonstration purposes only | Powered by GitHub Pages</p>
        </footer>
    </div>

    <script>
        // 奖品配置 - 第五个奖项为智能锁
        const prizes = [
            { name: "30% Off on D2 Plus", color: "#CD7F32", probability: 10, description: "30% Off on D2 Plus" },
            { name: "30% Off on D2 Pro", color: "#FFD700", probability: 5, description: "30% Off on D2 Pro" },            
            { name: "40% Off on D2 Plus", color: "#C0C0C0", probability: 5, description: "40% Off on D2 Plus" },
            { name: "40% Off on D2 Pro", color: "#FF6B6B", probability: 5, description: "40% Off on D2 Pro" },
            { name: "50% Off on D2 Pro", color: "#95A5A6", probability: 5, description: "50% Off on D2 Pro" },
            { name: "Free D2 Pro", color: "#4ECDC4", probability: 70, description: "Free D2 Pro" }, 
        ];
                
        // 特殊奖项配置
        const SPECIAL_PRIZE_INDEX = 5; // 第五个奖项（智能锁）的索引
        const MAX_WINNERS = 6; // 最多6人中奖
        
        // 初始化变量
        let isSpinning = false;
        let currentRotation = 0;
        let spinCount = 0;
        const maxSpins = 1; // 每人限抽一次
        let currentSelectedPrizeIndex = 0; // 当前选中的奖品索引
        
        // DOM元素
        const wheel = document.getElementById('wheel');
        const spinBtn = document.getElementById('spinBtn');
        const currentResult = document.getElementById('currentResult');
        const prizesList = document.getElementById('prizesList');
        const historyList = document.getElementById('historyList');
        const remainingSpinsElement = document.getElementById('remainingSpins');
        
        // 弹窗相关元素
        const specialPrizeModal = document.getElementById('specialPrizeModal');
        const closeModalBtn = document.querySelector('.close-modal');
        const addressForm = document.getElementById('addressForm');
        
        // 初始化轮盘
        function initWheel() {
            wheel.innerHTML = '';
            const centerX = 150;
            const centerY = 150;
            const radius = 140;
            const anglePerPrize = 2 * Math.PI / prizes.length;
            
            // 创建轮盘扇区
            prizes.forEach((prize, index) => {
                const startAngle = index * anglePerPrize;
                const endAngle = (index + 1) * anglePerPrize;
                
                // 计算扇区路径
                const x1 = centerX + radius * Math.sin(startAngle);
                const y1 = centerY - radius * Math.cos(startAngle);
                const x2 = centerX + radius * Math.sin(endAngle);
                const y2 = centerY - radius * Math.cos(endAngle);
                
                // 创建扇区路径
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                const d = `
                    M ${centerX} ${centerY}
                    L ${x1} ${y1}
                    A ${radius} ${radius} 0 0 1 ${x2} ${y2}
                    Z
                `;
                path.setAttribute("d", d);
                path.setAttribute("fill", prize.color);
                path.setAttribute("stroke", "#fff");
                path.setAttribute("stroke-width", "2");
                path.setAttribute("data-index", index);
                wheel.appendChild(path);
                
                // 添加奖品文本
                const textAngle = startAngle + anglePerPrize / 2;
                const textRadius = radius * 0.7;
                const textX = centerX + textRadius * Math.sin(textAngle);
                const textY = centerY - textRadius * Math.cos(textAngle);
                
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", textX);
                text.setAttribute("y", textY);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("fill", "#000");
                text.setAttribute("font-weight", "bold");
                text.setAttribute("font-size", "14");
                text.setAttribute("transform", `rotate(${textAngle * 180 / Math.PI}, ${textX}, ${textY})`);
                
                // 分割长文本
                if (prize.name.length > 12) {
                    const words = prize.name.split(' ');
                    if (words.length > 1) {
                        text.innerHTML = `<tspan x="${textX}" dy="-0.3em">${words.slice(0, words.length-1).join(' ')}</tspan>
                                          <tspan x="${textX}" dy="1.2em">${words[words.length-1]}</tspan>`;
                    } else {
                        text.textContent = prize.name;
                    }
                } else {
                    text.textContent = prize.name;
                }
                
                wheel.appendChild(text);
            });
            
            // 添加中心圆
            const centerCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            centerCircle.setAttribute("cx", centerX);
            centerCircle.setAttribute("cy", centerY);
            centerCircle.setAttribute("r", 30);
            centerCircle.setAttribute("fill", "#fff");
            centerCircle.setAttribute("stroke", "#333");
            centerCircle.setAttribute("stroke-width", "3");
            wheel.appendChild(centerCircle);
            
            // 添加中心文字
            const centerText = document.createElementNS("http://www.w3.org/2000/svg", "text");
            centerText.setAttribute("x", centerX);
            centerText.setAttribute("y", centerY + 5);
            centerText.setAttribute("text-anchor", "middle");
            centerText.setAttribute("fill", "#2575fc");
            centerText.setAttribute("font-weight", "bold");
            centerText.setAttribute("font-size", "16");
            centerText.textContent = "WIN!";
            wheel.appendChild(centerText);
        }
        
        // 初始化奖品列表（无概率显示）
        function initPrizesList() {
            prizesList.innerHTML = '';
            prizes.forEach(prize => {
                const prizeItem = document.createElement('div');
                prizeItem.className = 'prize-item';
                prizeItem.innerHTML = `
                    <div class="prize-name">${prize.name}</div>
                `;
                prizesList.appendChild(prizeItem);
            });
        }
        
        // 创建彩花效果
        function createConfetti() {
            const colors = ['#FFD700', '#C0C0C0', '#FF6B6B', '#4ECDC4', '#FF8A00', '#2575fc'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 15 + 10 + 'px';
                confetti.style.height = Math.random() * 15 + 10 + 'px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                
                document.body.appendChild(confetti);
                
                // 动画
                const animation = confetti.animate([
                    { transform: 'translateY(-100px) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight + 100}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 3000 + 2000,
                    easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
                });
                
                // 动画结束后移除元素
                animation.onfinish = () => {
                    confetti.remove();
                };
            }
        }
        
        // 处理特殊奖项名额已满的情况
        function handleSpecialPrizeLimit(selectedIndex) {
            // 从localStorage获取当前中奖人数
            let currentWinners = parseInt(localStorage.getItem('specialPrizeWinners')) || 0;
            
            // 如果抽中的是特殊奖项且名额已满
            if (selectedIndex === SPECIAL_PRIZE_INDEX && currentWinners >= MAX_WINNERS) {
                // 创建一个不包含特殊奖项的临时数组用于重抽
                let availablePrizes = [];
                let availableProbabilities = [];
                
                prizes.forEach((prize, index) => {
                    if (index !== SPECIAL_PRIZE_INDEX) {
                        availablePrizes.push(prize);
                        availableProbabilities.push(prize.probability);
                    }
                });
                
                // 根据概率重新抽取一个其他奖项
                const randomValue = Math.random() * availableProbabilities.reduce((a, b) => a + b, 0);
                let cumulativeProbability = 0;
                
                for (let i = 0; i < availableProbabilities.length; i++) {
                    cumulativeProbability += availableProbabilities[i];
                    if (randomValue <= cumulativeProbability) {
                        // 将新索引映射回原始数组
                        return (i >= SPECIAL_PRIZE_INDEX) ? i + 1 : i;
                    }
                }
            }
            
            // 如果没有触发限制，返回原索引
            return selectedIndex;
        }
        
        // 旋转轮盘
        function spinWheel() {
            if (isSpinning || spinCount >= maxSpins) return;
            
            isSpinning = true;
            spinBtn.disabled = true;
            spinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> SPINNING...';
            
            // 生成随机结果（根据概率）
            const randomValue = Math.random() * 100;
            let cumulativeProbability = 0;
            let selectedPrizeIndex = 0;
            
            for (let i = 0; i < prizes.length; i++) {
                cumulativeProbability += prizes[i].probability;
                if (randomValue <= cumulativeProbability) {
                    selectedPrizeIndex = i;
                    break;
                }
            }
            
            // 检查特殊奖项名额限制
            selectedPrizeIndex = handleSpecialPrizeLimit(selectedPrizeIndex);
            currentSelectedPrizeIndex = selectedPrizeIndex;
            
            // 如果特殊奖项名额已满且用户原本抽中了特殊奖，给出提示
            let currentWinners = parseInt(localStorage.getItem('specialPrizeWinners')) || 0;
            if (selectedPrizeIndex !== SPECIAL_PRIZE_INDEX && currentWinners >= MAX_WINNERS) {
                // 在旋转开始前给出提示
                setTimeout(() => {
                    alert("The Smart Lock special prize quota has been reached. You've been entered for another prize instead!");
                }, 500);
            }
            
            // 计算旋转角度
            const prizeAngle = 360 / prizes.length;
            const targetRotation = 3600 + (prizes.length - selectedPrizeIndex) * prizeAngle - prizeAngle / 2;
            
            // 应用旋转动画
            wheel.style.transition = 'transform 2.5s cubic-bezier(0.2, 0.8, 0.3, 1)';
            wheel.style.transform = `rotate(${currentRotation + targetRotation}deg)`;
            currentRotation += targetRotation;
            
            // 显示结果
            setTimeout(() => {
                const selectedPrize = prizes[selectedPrizeIndex];
                currentResult.innerHTML = `
                    <div style="color: ${selectedPrize.color}; text-shadow: 1px 1px 3px rgba(0,0,0,0.2);">
                        ${selectedPrize.name}
                    </div>
                `;
                
                // 添加到中奖历史
                addToHistory(selectedPrize);
                
                // 更新旋转计数
                spinCount++;
                remainingSpinsElement.textContent = maxSpins - spinCount;
                
                // 禁用按钮
                spinBtn.disabled = true;
                spinBtn.innerHTML = '<i class="fas fa-check"></i> PRIZE WON!';
                
                // 如果是特殊奖项且名额未满，显示弹窗
                if (selectedPrizeIndex === SPECIAL_PRIZE_INDEX) {
                    currentWinners = parseInt(localStorage.getItem('specialPrizeWinners')) || 0;
                    if (currentWinners < MAX_WINNERS) {
                        setTimeout(() => {
                            specialPrizeModal.style.display = 'block';
                            document.body.style.overflow = 'hidden';
                        }, 1000);
                    }
                }
                
                // 显示彩花效果（所有奖项都有）
                createConfetti();
                currentResult.classList.add("pulse");
                
                isSpinning = false;
            }, 2500);
            
            // 显示旋转中消息
            setTimeout(() => {
                currentResult.innerHTML = '<div><i class="fas fa-spinner fa-spin"></i> Spinning...</div>';
            }, 500);
        }
        
        // 添加到历史记录
        function addToHistory(prize) {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            // 生成随机用户名
            const userNames = ["Alex", "Jamie", "Taylor", "Jordan", "Casey", "Riley", "Morgan", "Quinn", "Sam", "Jordan"];
            const randomName = userNames[Math.floor(Math.random() * userNames.length)];
            
            historyItem.innerHTML = `
                <div>${randomName} - ${prize.name}</div>
                <div>${timeString}</div>
            `;
            
            // 将新记录添加到顶部
            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // 限制历史记录数量
            if (historyList.children.length > 10) {
                historyList.removeChild(historyList.lastChild);
            }
        }
        
        // 初始化历史记录
        function initHistory() {
            // 初始化示例数据
            const samplePrizes = prizes.map(p => p.name);
            const sampleTimes = ["10:25:34", "10:18:22", "10:12:45", "10:05:12", "09:58:33"];
            const sampleNames = ["Alex Johnson", "Sam Wilson", "Taylor Smith", "Jordan Lee", "Casey Brown"];
            
            samplePrizes.forEach((prize, index) => {
                if (index < sampleTimes.length) {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div>${sampleNames[index]} - ${prize}</div>
                        <div>${sampleTimes[index]}</div>
                    `;
                    historyList.appendChild(historyItem);
                }
            });
        }
        
        // 更新旋转计数显示
        function updateSpinCounter() {
            remainingSpinsElement.textContent = maxSpins - spinCount;
        }
        
        // --- 弹窗控制逻辑 ---
        
        // 关闭弹窗
        closeModalBtn.addEventListener('click', () => {
            specialPrizeModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        // 点击弹窗外部关闭
        window.addEventListener('click', (event) => {
            if (event.target === specialPrizeModal) {
                specialPrizeModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });
        
        // 处理表单提交
        addressForm.addEventListener('submit', (event) => {
            event.preventDefault();
            
            const name = document.getElementById('userName').value;
            const address = document.getElementById('userAddress').value;
            const phone = document.getElementById('userPhone').value;
            
            // Google Form配置 - 使用你提供的链接和ID
            const googleFormBaseUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSd4yqIVaKMFlYDeBul9GyYyoFZbTcOO3Xhemt0QzK7m7KRSQA/viewform';
            const nameFieldId = 'entry.538168884';
            const addressFieldId = 'entry.717278941';
            const phoneFieldId = 'entry.140336387';
            
            // 构建预填URL
            const prefilledFormUrl = `${googleFormBaseUrl}?${nameFieldId}=${encodeURIComponent(name)}&${addressFieldId}=${encodeURIComponent(address)}&${phoneFieldId}=${encodeURIComponent(phone)}`;
            
            // 更新中奖人数计数
            let currentWinners = parseInt(localStorage.getItem('specialPrizeWinners')) || 0;
            localStorage.setItem('specialPrizeWinners', currentWinners + 1);
            
            // 给用户提示
            alert(`You are winner No.${currentWinners + 1} for the Smart Lock! Please confirm and submit your information on the Google Form page.`);
            
            // 跳转到预填的Google Form
            window.open(prefilledFormUrl, '_blank');
            
            // 关闭弹窗并重置表单
            specialPrizeModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            addressForm.reset();
        });
        
        // 页面加载初始化
        document.addEventListener('DOMContentLoaded', () => {
            initWheel();
            initPrizesList();
            initHistory();
            updateSpinCounter();
            
            // 绑定旋转按钮事件
            spinBtn.addEventListener('click', spinWheel);
            
            // 初始轮盘动画
            setTimeout(() => {
                wheel.style.transition = 'transform 1s ease';
                wheel.style.transform = 'rotate(360deg)';
                
                setTimeout(() => {
                    wheel.style.transition = 'transform 0.5s ease';
                    wheel.style.transform = 'rotate(0deg)';
                }, 1000);
            }, 500);
            
            // 显示特殊奖项剩余名额
            const currentWinners = parseInt(localStorage.getItem('specialPrizeWinners')) || 0;
            const remaining = MAX_WINNERS - currentWinners;
            if (remaining > 0) {
                console.log(`Smart Lock special prize: ${remaining} remaining of ${MAX_WINNERS}`);
            } else {
                console.log('Smart Lock special prize: All claimed!');
            }
        });
    </script>
</body>
</html>
